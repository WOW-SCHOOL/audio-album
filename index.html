<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WOW SCHOOL — English File: Beginner</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="color-scheme" content="dark light" />
</head>
<body>
  <div class="wrap">

    <!-- ====== HEADER ====== -->
    <header class="site-header">
      <div class="brand">
        <!-- Если будет png/svg-логотип, положите рядом и раскомментируйте строку ниже -->
        <!-- <img src="logo.png" alt="WOW SCHOOL" class="brand-logo" /> -->
        <span class="brand-text">WOW SCHOOL</span>
        <h1 class="album-title">English File: Beginner</h1>
      </div>
    </header>

    <!-- ====== PLAYER ====== -->
    <main>
      <section class="player-card">
        <div class="now">
          <div class="meta">
            <div id="trackTitle" class="track-title">—</div>
            <div id="trackSub" class="track-sub">00:00 / 00:00</div>
          </div>

          <div class="controls">
            <button id="btnPrev" class="btn" aria-label="Предыдущий трек">⏮</button>
            <button id="btnPlay" class="btn" aria-label="Пуск/Пауза">▶️/⏸</button>
            <button id="btnNext" class="btn" aria-label="Следующий трек">⏭</button>
          </div>

          <div class="seek">
            <input id="seek" type="range" min="0" max="100" value="0" />
            <div id="time" class="time">0:00 / 0:00</div>
          </div>
        </div>

        <ol id="list" class="list"></ol>
      </section>
    </main>

  </div>

  <script>
    // ===== Простенький плеер =====
    const audio = new Audio();
    let playlist = [];
    let index = 0;
    let isSeeking = false;

    const elTitle = document.getElementById('trackTitle');
    const elSub   = document.getElementById('trackSub');
    const elList  = document.getElementById('list');
    const elSeek  = document.getElementById('seek');
    const elTime  = document.getElementById('time');
    const btnPlay = document.getElementById('btnPlay');
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');

    fetch('playlist.json')
      .then(r => r.json())
      .then(data => {
        playlist = data.tracks || [];
        renderList();
        if (playlist.length) load(0);
      });

    function renderList(){
      elList.innerHTML = '';
      playlist.forEach((t, i) => {
        const li = document.createElement('li');
        li.className = 'row';
        li.innerHTML = `
          <span class="no">${i+1}</span>
          <button class="row-btn" data-i="${i}" title="Воспроизвести">
            <span class="row-title">${t.title}</span>
            <span class="row-len" id="len-${i}">—</span>
          </button>`;
        elList.appendChild(li);

        // предзагрузка длительности (лениво)
        const a = new Audio();
        a.src = t.file;
        a.addEventListener('loadedmetadata', () => {
          const s = Math.floor(a.duration||0);
          document.getElementById(`len-${i}`).textContent = fmt(s);
        });
      });

      elList.addEventListener('click', e => {
        const btn = e.target.closest('.row-btn');
        if (!btn) return;
        const i = +btn.dataset.i;
        if (!isNaN(i)) {
          load(i);
          play();
        }
      }, { once: true });
    }

    function load(i){
      index = i;
      const t = playlist[index];
      audio.src = t.file;
      elTitle.textContent = t.title || '—';
      elSub.textContent   = t.artist ? t.artist : '';
      highlight();
    }

    function highlight(){
      [...document.querySelectorAll('.row')].forEach((r, i) =>
        r.classList.toggle('active', i===index)
      );
    }

    function play(){ audio.play(); }
    function pause(){ audio.pause(); }

    btnPlay.onclick = () => audio.paused ? play() : pause();
    btnPrev.onclick = () => { index = (index-1+playlist.length)%playlist.length; load(index); play(); };
    btnNext.onclick = () => { index = (index+1)%playlist.length; load(index); play(); };

    audio.addEventListener('timeupdate', () => {
      if (isSeeking) return;
      const cur = audio.currentTime||0;
      const dur = audio.duration||0;
      const pct = dur ? cur/dur*100 : 0;
      elSeek.value = pct;
      elTime.textContent = `${fmt(cur)} / ${fmt(dur)}`;
    });
    audio.addEventListener('ended', () => btnNext.click());

    elSeek.addEventListener('input', () => isSeeking = true);
    elSeek.addEventListener('change', () => {
      const dur = audio.duration||0;
      audio.currentTime = dur * (+elSeek.value/100);
      isSeeking = false;
    });

    function fmt(s){
      s = Math.max(0, Math.floor(s));
      const m = Math.floor(s/60);
      const r = s%60;
      return `${m}:${String(r).padStart(2,'0')}`;
    }
  </script>
</body>
</html>
